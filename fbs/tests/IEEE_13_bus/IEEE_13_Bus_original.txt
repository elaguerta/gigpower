============================= test session starts ==============================
platform darwin -- Python 3.8.5, pytest-6.0.1, py-1.9.0, pluggy-0.13.1
rootdir: /Users/elainelaguerta/Dropbox/LBNL/LinDist3Flow/fbs
collected 1 item

fbs/tests/test_compare_opendss.py 

Testing File: fbs/tests/IEEE_13_bus/IEEE_13_Bus_original.dss

Opendss Iterations: 4	Opendss Convergence: 0.0001
OpenDSS Loads after solving, from dss.CktElement.Powers():
[531.904058622343, 125.85346361148127, 68.33502219028553, -157.16133459566387, 416.9083831864674, 53.6423233968978, -531.9040532519522, -125.85346361148127, -68.33502172030666, 157.16133459566387, -416.9083798902876, -53.642323396897844]
FBS iterations: 1	 FBS convergence:0.0	 FBS tolerance: 1e-09


COMPARE V
Max |diff|:
A.(fbs - dss)   0.5175
B.(fbs - dss)   0.5175
C.(fbs - dss)   0.5175
dtype: float64
            A.(fbs - dss)   B.(fbs - dss)   C.(fbs - dss)
sourcebus  0.1339-0.4999j -0.4998+0.1340j  0.3659+0.3659j
650        0.0001+0.0002j  0.0001-0.0001j -0.0002-0.0001j
rg60      -0.0308+0.0439j  0.0268+0.0013j -0.0352-0.0310j
633       -0.0098+0.0462j  0.0413+0.0071j -0.0339-0.0200j
634        0.0149+0.0569j  0.0384-0.0130j -0.0502-0.0070j
671        0.0286+0.0970j  0.0610+0.0135j -0.0788+0.0010j
645        0.0000+0.0000j  0.0382-0.0024j -0.0347-0.0194j
646        0.0000+0.0000j  0.0397-0.0024j -0.0333-0.0183j
692        0.0286+0.0970j  0.0610+0.0135j -0.0788+0.0010j
675        0.0293+0.0964j  0.0613+0.0133j -0.0786+0.0012j
611        0.0000+0.0000j  0.0000+0.0000j -0.0837+0.0014j
652        0.0301+0.0912j  0.0000+0.0000j -0.0000+0.0000j
670        0.0240+0.1015j  0.0600+0.0154j -0.0783+0.0015j
632       -0.0129+0.0452j  0.0360-0.0026j -0.0371-0.0211j
680        0.0224+0.0928j  0.0573+0.0130j -0.0780-0.0007j
684        0.0301+0.0917j  0.0000+0.0000j -0.0837+0.0009j 

FBS results
                       A               B               C
sourcebus 1.0000+0.0000j -0.5000-0.8660j -0.5000+0.8660j
650       1.0000+0.0000j -0.5000-0.8660j -0.5000+0.8660j
rg60      1.0253+0.0437j -0.4921-0.8970j -0.5629+0.8837j
633       1.0000+0.0000j -0.5000-0.8660j -0.5000+0.8660j
634       1.0000+0.0000j -0.5000-0.8660j -0.5000+0.8660j
671       1.0062+0.0042j -0.4963-0.8656j -0.5008+0.8677j
645       0.0000+0.0000j -0.5012-0.8682j -0.5017+0.8671j
646       0.0000+0.0000j -0.5000-0.8660j -0.5000+0.8660j
692       1.0062+0.0042j -0.4963-0.8656j -0.5008+0.8677j
675       1.0000+0.0000j -0.5000-0.8660j -0.5000+0.8660j
611       0.0000+0.0000j  0.0000+0.0000j -0.5000+0.8660j
652       1.0000+0.0000j  0.0000+0.0000j -0.0000+0.0000j
670       1.0257+0.0405j -0.4864-0.8604j -0.5287+0.8822j
632       1.0000+0.0000j -0.5055-0.8778j -0.5045+0.8672j
680       1.0000+0.0000j -0.5000-0.8660j -0.5000+0.8660j
684       1.0057-0.0013j  0.0000+0.0000j -0.5032+0.8665j 

DSS results
                       A               B               C
sourcebus 0.8661+0.4999j -0.0002-1.0000j -0.8659+0.5001j
650       0.9999-0.0002j -0.5001-0.8659j -0.4998+0.8661j
rg60      1.0560-0.0002j -0.5189-0.8983j -0.5278+0.9147j
633       1.0098-0.0462j -0.5413-0.8732j -0.4661+0.8860j
634       0.9851-0.0569j -0.5384-0.8530j -0.4498+0.8730j
671       0.9776-0.0928j -0.5573-0.8790j -0.4220+0.8667j
645       0.0000+0.0000j -0.5394-0.8658j -0.4670+0.8865j
646       0.0000+0.0000j -0.5397-0.8637j -0.4667+0.8843j
692       0.9776-0.0928j -0.5573-0.8790j -0.4220+0.8667j
675       0.9707-0.0964j -0.5613-0.8793j -0.4214+0.8648j
611       0.0000+0.0000j  0.0000+0.0000j -0.4163+0.8647j
652       0.9699-0.0912j  0.0000+0.0000j  0.0000+0.0000j
670       1.0016-0.0610j -0.5464-0.8758j -0.4504+0.8807j
632       1.0129-0.0452j -0.5416-0.8752j -0.4675+0.8883j
680       0.9776-0.0928j -0.5573-0.8790j -0.4220+0.8667j
684       0.9756-0.0931j  0.0000+0.0000j -0.4195+0.8655j


COMPARE I
Max |diff|:
A.(fbs - dss)   36.4908
B.(fbs - dss)   26.8769
C.(fbs - dss)   38.3067
dtype: float64
                 A.(fbs - dss)    B.(fbs - dss)   C.(fbs - dss)
line_632_633   -4.2974+3.3349j   3.8411+1.4644j -0.7051-4.1629j
line_632_645    0.0000+0.0000j   7.2394+5.5117j -2.2358-3.4115j
line_632_670 -27.5585+14.4635j   9.9161+9.8022j 5.0852-30.6722j
line_645_646    0.0000+0.0000j   2.1208+3.4775j -2.2358-3.4115j
line_650_632 -31.8559+17.7983j 20.9965+16.7783j 2.1444-38.2466j
line_670_671 -27.1247+14.1691j   8.1834+8.8805j 5.2900-27.0275j
line_671_680   -0.0000-0.0000j  -0.0000+0.0000j  0.0000+0.0000j
line_671_684   -3.2601+2.6815j   0.0000+0.0000j  2.3394-4.1219j
line_671_692  -14.0015+4.8773j  -2.4663+3.6391j 3.7387-11.0545j
line_684_611    0.0000+0.0000j   0.0000+0.0000j  2.3394-4.1219j
line_684_652   -3.2601+2.6816j   0.0000+0.0000j  0.0000+0.0000j
line_692_675  -13.1930+1.3573j  -2.4663+3.6391j  2.8227-7.5710j
reg3               nan+0.0000j      nan+0.0000j     nan+0.0000j
reg3               nan+0.0000j      nan+0.0000j     nan+0.0000j
sub                nan+0.0000j      nan+0.0000j     nan+0.0000j
xfm1               nan+0.0000j      nan+0.0000j     nan+0.0000j 

FBS results
                          A               B               C
line_650_632 1.0983-0.3768j -0.6697-0.5443j -0.2181+1.2123j
line_632_670 1.0983-0.3768j -0.3623-0.3931j -0.2178+1.0797j
line_670_671 1.0813-0.3677j -0.2960-0.3539j -0.2160+0.9481j
line_671_680 0.0000+0.0000j -0.0000+0.0000j  0.0000+0.0000j
line_632_633 0.0000+0.0000j  0.0000+0.0000j  0.0000+0.0000j
line_632_645 0.0000+0.0000j -0.3074-0.1511j -0.0003+0.1326j
line_645_646 0.0000+0.0000j -0.1147-0.0666j -0.0003+0.1326j
line_692_675 0.4850+0.0100j  0.0872-0.1289j -0.1346+0.2571j
line_671_684 0.1280-0.0860j  0.0000+0.0000j -0.1023+0.1372j
line_684_611 0.0000+0.0000j  0.0000+0.0000j -0.1023+0.1372j
line_684_652 0.1280-0.0860j  0.0000+0.0000j  0.0000+0.0000j
line_671_692 0.5698-0.0647j  0.0872-0.1289j -0.1118+0.3683j
sub          0.0000+0.0000j  0.0000+0.0000j  0.0000+0.0000j
xfm1         0.0000+0.0000j  0.0000+0.0000j  0.0000+0.0000j
reg3         0.0000+0.0000j -0.0000+0.0000j  0.0000+0.0000j
reg3         0.0000+0.0000j  0.0000+0.0000j  0.0000+0.0000j 

DSS results
                            A                 B                C
line_650_632 32.9542-18.1751j -21.6663-17.3226j -2.3625+39.4589j
line_632_670 28.6567-14.8402j -10.2784-10.1954j -5.3029+31.7519j
line_670_671 28.2060-14.5368j   -8.4794-9.2344j -5.5060+27.9756j
line_671_680   0.0000+0.0000j    0.0000-0.0000j  -0.0000-0.0000j
line_632_633   4.2974-3.3349j   -3.8411-1.4644j   0.7051+4.1629j
line_632_645   0.0000+0.0000j   -7.5468-5.6628j   2.2354+3.5441j
line_645_646   0.0000+0.0000j   -2.2354-3.5441j   2.2354+3.5441j
line_692_675  13.6780-1.3473j    2.5536-3.7680j  -2.9573+7.8281j
line_671_684   3.3881-2.7675j    0.0000+0.0000j  -2.4417+4.2591j
line_684_611   0.0000+0.0000j    0.0000+0.0000j  -2.4417+4.2591j
line_684_652   3.3881-2.7676j    0.0000+0.0000j   0.0000+0.0000j
line_671_692  14.5713-4.9420j    2.5536-3.7680j -3.8505+11.4228j


COMPARE Stx
Max |diff|:
A.(fbs - dss)   0.2997
B.(fbs - dss)   0.1586
C.(fbs - dss)   0.2428
dtype: float64
               A.(fbs - dss)   B.(fbs - dss)   C.(fbs - dss)
line_632_633 -0.1629-0.1152j -0.1216-0.0929j -0.1218-0.0930j
line_632_645  0.0000+0.0000j -0.0391+0.0655j  0.0391-0.0652j
line_632_670  0.0240-0.1202j  0.0041-0.0064j -0.0638-0.0106j
line_645_646  0.0000+0.0000j -0.0393+0.0653j  0.0393-0.0653j
line_650_632 -0.1495-0.2597j -0.1518-0.0460j -0.1566-0.1855j
line_670_671  0.0401-0.0435j -0.0116-0.0036j -0.0303+0.0303j
line_671_680  0.0000+0.0000j -0.0000+0.0000j -0.0000+0.0000j
line_671_684 -0.0007+0.0006j -0.0000+0.0000j -0.0005-0.0085j
line_671_692  0.0411-0.0584j -0.0001+0.0177j -0.0414+0.0338j
line_684_611  0.0000-0.0000j  0.0000+0.0000j -0.0000-0.0078j
line_684_652 -0.0000+0.0001j  0.0000+0.0000j  0.0000+0.0000j
line_692_675 -0.0002-0.0097j -0.0001+0.0177j -0.0000-0.0148j
reg3             nan+0.0000j     nan+0.0000j     nan+0.0000j
reg3             nan+0.0000j     nan+0.0000j     nan+0.0000j
sub              nan+0.0000j     nan+0.0000j     nan+0.0000j
xfm1             nan+0.0000j     nan+0.0000j     nan+0.0000j 

FBS results
                          A               B              C
line_650_632 1.1095+0.4343j  0.8178+0.3329j 1.1941+0.4897j
line_632_670 1.0983+0.3768j  0.5283+0.1193j 1.0461+0.3559j
line_670_671 1.0942+0.4209j  0.4485+0.0825j 0.9506+0.3108j
line_671_680 0.0000+0.0000j  0.0000+0.0000j 0.0000+0.0000j
line_632_633 0.0000+0.0000j -0.0000+0.0000j 0.0000+0.0000j
line_632_645 0.0000+0.0000j  0.2881+0.1935j 0.1152+0.0666j
line_645_646 0.0000+0.0000j  0.1153+0.0662j 0.1151+0.0662j
line_692_675 0.4880-0.0080j  0.0683-0.1395j 0.2905+0.0120j
line_671_684 0.1284+0.0871j -0.0000+0.0000j 0.1703-0.0201j
line_684_611 0.0000-0.0000j  0.0000+0.0000j 0.1704-0.0196j
line_684_652 0.1288+0.0863j  0.0000+0.0000j 0.0000+0.0000j
line_671_692 0.5730+0.0675j  0.0683-0.1395j 0.3755+0.0875j
sub          0.0000+0.0000j -0.0000+0.0000j 0.0000+0.0000j
xfm1         0.0000+0.0000j -0.0000+0.0000j 0.0000+0.0000j
reg3         0.0000+0.0000j  0.0000+0.0000j 0.0000+0.0000j
reg3         0.0000+0.0000j -0.0000+0.0000j 0.0000+0.0000j 

DSS results
                           A              B              C
line_650_632  1.2590+0.6940j 0.9696+0.3789j 1.3507+0.6752j
line_632_670  1.0743+0.4970j 0.5242+0.1257j 1.1100+0.3665j
line_670_671  1.0541+0.4644j 0.4601+0.0861j 0.9810+0.2804j
line_671_680 -0.0000-0.0000j 0.0000-0.0000j 0.0000-0.0000j
line_632_633  0.1629+0.1152j 0.1216+0.0929j 0.1218+0.0930j
line_632_645  0.0000+0.0000j 0.3271+0.1280j 0.0761+0.1318j
line_645_646  0.0000+0.0000j 0.1546+0.0009j 0.0759+0.1316j
line_692_675  0.4882+0.0017j 0.0683-0.1572j 0.2906+0.0268j
line_671_684  0.1291+0.0865j 0.0000+0.0000j 0.1708-0.0115j
line_684_611  0.0000+0.0000j 0.0000+0.0000j 0.1704-0.0118j
line_684_652  0.1289+0.0863j 0.0000+0.0000j 0.0000+0.0000j
line_671_692  0.5319+0.1259j 0.0683-0.1572j 0.4169+0.0536j


COMPARE Srx
Max |diff|:
A.(fbs - dss)   0.2733
B.(fbs - dss)   0.1602
C.(fbs - dss)   0.2236
dtype: float64
               A.(fbs - dss)   B.(fbs - dss)   C.(fbs - dss)
line_632_633 -0.1626-0.1146j -0.1215-0.0927j -0.1215-0.0928j
line_632_645  0.0000+0.0000j -0.0393+0.0653j  0.0393-0.0653j
line_632_670  0.0401-0.0435j -0.0116-0.0036j -0.0303+0.0303j
line_645_646  0.0000+0.0000j -0.0394+0.0653j  0.0394-0.0653j
line_650_632 -0.1389-0.2353j -0.1566-0.0338j -0.1466-0.1688j
line_670_671  0.0402-0.0448j -0.0113-0.0030j -0.0303+0.0330j
line_671_680 -0.0000-0.0000j  0.0000-0.0000j -0.0000-0.0000j
line_671_684 -0.0000+0.0001j  0.0000+0.0000j -0.0000-0.0078j
line_671_692  0.0411-0.0584j -0.0001+0.0177j -0.0414+0.0338j
line_684_611  0.0000+0.0000j  0.0000+0.0000j  0.0000-0.0078j
line_684_652 -0.0000-0.0000j  0.0000+0.0000j  0.0000+0.0000j
line_692_675 -0.0000-0.0097j -0.0000+0.0176j  0.0000-0.0149j
reg3             nan+0.0000j     nan+0.0000j     nan+0.0000j
reg3             nan+0.0000j     nan+0.0000j     nan+0.0000j
sub              nan+0.0000j     nan+0.0000j     nan+0.0000j
xfm1             nan+0.0000j     nan+0.0000j     nan+0.0000j 

FBS results
                          A               B              C
line_650_632 1.0983+0.3768j  0.8163+0.3128j 1.1613+0.4225j
line_632_670 1.1112+0.4309j  0.5145+0.1205j 1.0676+0.3788j
line_670_671 1.0865+0.3746j  0.4533+0.0805j 0.9308+0.2874j
line_671_680 0.0000+0.0000j  0.0000+0.0000j 0.0000+0.0000j
line_632_633 0.0000+0.0000j -0.0000+0.0000j 0.0000+0.0000j
line_632_645 0.0000+0.0000j  0.2853+0.1912j 0.1151+0.0662j
line_645_646 0.0000+0.0000j  0.1150+0.0660j 0.1150+0.0660j
line_692_675 0.4850-0.0100j  0.0680-0.1400j 0.2900+0.0120j
line_671_684 0.1288+0.0863j  0.0000+0.0000j 0.1704-0.0196j
line_684_611 0.0000+0.0000j  0.0000+0.0000j 0.1700-0.0200j
line_684_652 0.1280+0.0860j  0.0000+0.0000j 0.0000+0.0000j
line_671_692 0.5730+0.0675j  0.0683-0.1395j 0.3755+0.0875j
sub          0.0000+0.0000j -0.0000+0.0000j 0.0000+0.0000j
xfm1         0.0000+0.0000j -0.0000+0.0000j 0.0000+0.0000j
reg3         0.0000+0.0000j  0.0000+0.0000j 0.0000+0.0000j
reg3         0.0000+0.0000j -0.0000+0.0000j 0.0000+0.0000j 

DSS results
                          A               B              C
line_650_632 1.2372+0.6121j  0.9729+0.3466j 1.3079+0.5913j
line_632_670 1.0711+0.4744j  0.5261+0.1241j 1.0979+0.3484j
line_670_671 1.0463+0.4194j  0.4646+0.0835j 0.9612+0.2544j
line_671_680 0.0000+0.0000j -0.0000+0.0000j 0.0000+0.0000j
line_632_633 0.1626+0.1146j  0.1215+0.0927j 0.1215+0.0928j
line_632_645 0.0000+0.0000j  0.3246+0.1259j 0.0759+0.1316j
line_645_646 0.0000+0.0000j  0.1544+0.0007j 0.0756+0.1313j
line_692_675 0.4850-0.0003j  0.0680-0.1576j 0.2900+0.0269j
line_671_684 0.1289+0.0863j  0.0000+0.0000j 0.1704-0.0118j
line_684_611 0.0000+0.0000j  0.0000+0.0000j 0.1700-0.0122j
line_684_652 0.1280+0.0860j  0.0000+0.0000j 0.0000+0.0000j
line_671_692 0.5319+0.1259j  0.0683-0.1572j 0.4169+0.0536j
F

=================================== FAILURES ===================================
___________________________________ test_all ___________________________________

    def test_all():
        """
        Compare the python FBS solution to the opendss solution.
        To save output, run from command line:
        pytest ./fbs/tests/test_compare_opendss.py -s >[OUTPUT FILE PATH]
        Examples:
        $ pytest ./fbs/tests/test_compare_opendss.py -s > ./fbs/tests/06n3ph_unbal/06n3ph_out.txt
        $ pytest ./fbs/tests/test_compare_opendss.py -s > ./fbs/tests/05n3ph_unbal/05n3ph_out.txt
        """
        tolerance = .01
        for file in dss_files:
            print(f'\n\nTesting File: {file}')
>           compare_fbs_sol(file, tolerance)

fbs/tests/test_compare_opendss.py:32: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dss_file = 'fbs/tests/IEEE_13_bus/IEEE_13_Bus_original.dss', tolerance = 0.01

    def compare_fbs_sol(dss_file, tolerance):
        #TODO: Figure out how to get Inode (iNR) and sV (sNR) at each node from dss and perform a compare
        # solve with fbs
        network = init_from_dss(dss_file)
        fbs_sol = get_fbs_solution(fbs(network))
    
        # solve with dss
        dss_sol = solve_with_dss(dss_file)
    
        fbsV, fbsI, fbsStx, fbsSrx = fbs_sol.V_df(), fbs_sol.I_df(), fbs_sol.Stx_df(), fbs_sol.Srx_df()
        dssV, dssI, dssStx, dssSrx = dss_sol
        print(f"FBS iterations: {fbs_sol.iterations}\t FBS convergence:{fbs_sol.diff}\t FBS tolerance: {fbs_sol.tolerance}")
        print("\n\nCOMPARE V")
        V_maxDiff = compare_dfs(fbsV, dssV)
        print("\n\nCOMPARE I")
        I_maxDiff = compare_dfs(fbsI, dssI)
        print("\n\nCOMPARE Stx")
        Stx_maxDiff = compare_dfs(fbsStx, dssStx)
        print("\n\nCOMPARE Srx")
        Srx_maxDiff = compare_dfs(fbsSrx, dssSrx)
    
>       assert (V_maxDiff <= tolerance).all()
E       assert False
E        +  where False = <bound method Series.all of A.(fbs - dss)    False\nB.(fbs - dss)    False\nC.(fbs - dss)    False\ndtype: bool>()
E        +    where <bound method Series.all of A.(fbs - dss)    False\nB.(fbs - dss)    False\nC.(fbs - dss)    False\ndtype: bool> = A.(fbs - dss)   0.5175\nB.(fbs - dss)   0.5175\nC.(fbs - dss)   0.5175\ndtype: float64 <= 0.01.all

fbs/tests/test_compare_opendss.py:56: AssertionError
=============================== warnings summary ===============================
tests/test_compare_opendss.py::test_all
  /Users/elainelaguerta/Dropbox/LBNL/LinDist3Flow/fbs/fbs/solution.py:171: RuntimeWarning: invalid value encountered in true_divide
    new_line_I = np.conj(np.divide(node_s, node_V))

tests/test_compare_opendss.py::test_all
  /Users/elainelaguerta/Dropbox/LBNL/LinDist3Flow/fbs/fbs/solution.py:220: RuntimeWarning: invalid value encountered in true_divide
    node_I = np.conj(np.divide(node_sV,node_V))

-- Docs: https://docs.pytest.org/en/stable/warnings.html
=========================== short test summary info ============================
FAILED fbs/tests/test_compare_opendss.py::test_all - assert False
======================== 1 failed, 2 warnings in 1.39s =========================
