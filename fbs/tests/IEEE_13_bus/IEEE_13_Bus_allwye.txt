============================= test session starts ==============================
platform darwin -- Python 3.8.5, pytest-6.0.1, py-1.9.0, pluggy-0.13.1
rootdir: /Users/elainelaguerta/Dropbox/LBNL/LinDist3Flow/fbs
collected 1 item

fbs/tests/test_compare_opendss.py 

Testing File: fbs/tests/IEEE_13_bus/IEEE_13_Bus_allwye.dss

Opendss Iterations: 5	Opendss Convergence: 0.0001
OpenDSS Loads after solving, from dss.CktElement.Powers():
[572.1276605881841, 74.42048943355721, 68.84645009679359, -160.86565753803356, 371.97090017198894, 101.54950210472016, -572.1276546600556, -74.42048943355721, -68.84644961602424, 160.86565753803356, -371.9708973609864, -101.54950210472016]
FBS iterations: 1	 FBS convergence:0.0	 FBS tolerance: 1e-09


COMPARE V
Max |diff|:
A.(fbs - dss)   0.1082
B.(fbs - dss)   0.0656
C.(fbs - dss)   0.0844
dtype: float64
            A.(fbs - dss)  B.(fbs - dss)   C.(fbs - dss)
sourcebus  0.0000+0.0002j 0.0001-0.0001j -0.0002-0.0000j
650        0.0001+0.0002j 0.0001-0.0001j -0.0002-0.0000j
rg60      -0.0308+0.0440j 0.0299+0.0068j -0.0352-0.0310j
633       -0.0134+0.0490j 0.0394+0.0145j -0.0360-0.0191j
634        0.0113+0.0596j 0.0367-0.0055j -0.0524-0.0061j
671        0.0248+0.1053j 0.0601+0.0258j -0.0793+0.0079j
645        0.0000+0.0000j 0.0339+0.0050j -0.0392-0.0202j
646        0.0000+0.0000j 0.0338+0.0050j -0.0392-0.0201j
692        0.0248+0.1053j 0.0601+0.0258j -0.0793+0.0079j
675        0.0255+0.1047j 0.0604+0.0256j -0.0790+0.0082j
611        0.0000+0.0000j 0.0000+0.0000j -0.0840+0.0081j
652        0.0260+0.0995j 0.0000+0.0000j -0.0000+0.0000j
670        0.0204+0.1062j 0.0584+0.0244j -0.0799+0.0044j
632       -0.0165+0.0480j 0.0342+0.0048j -0.0393-0.0203j
680        0.0186+0.1011j 0.0564+0.0253j -0.0784+0.0063j
684        0.0262+0.1000j 0.0000+0.0000j -0.0840+0.0078j 

FBS results
                       A               B               C
sourcebus 1.0000+0.0000j -0.5000-0.8660j -0.5000+0.8660j
650       1.0000+0.0000j -0.5000-0.8660j -0.5000+0.8660j
rg60      1.0253+0.0437j -0.4921-0.8970j -0.5629+0.8837j
633       1.0000+0.0000j -0.5000-0.8660j -0.5000+0.8660j
634       1.0000+0.0000j -0.5000-0.8660j -0.5000+0.8660j
671       1.0062+0.0042j -0.4963-0.8656j -0.5008+0.8677j
645       0.0000+0.0000j -0.5012-0.8682j -0.5017+0.8671j
646       0.0000+0.0000j -0.5000-0.8660j -0.5000+0.8660j
692       1.0062+0.0042j -0.4963-0.8656j -0.5008+0.8677j
675       1.0000+0.0000j -0.5000-0.8660j -0.5000+0.8660j
611       0.0000+0.0000j  0.0000+0.0000j -0.5000+0.8660j
652       1.0000+0.0000j  0.0000+0.0000j -0.0000+0.0000j
670       1.0257+0.0405j -0.4864-0.8604j -0.5287+0.8822j
632       1.0000+0.0000j -0.5055-0.8778j -0.5045+0.8672j
680       1.0000+0.0000j -0.5000-0.8660j -0.5000+0.8660j
684       1.0057-0.0013j  0.0000+0.0000j -0.5032+0.8665j 

DSS results
                       A               B               C
sourcebus 1.0000-0.0002j -0.5001-0.8660j -0.4998+0.8661j
650       0.9999-0.0002j -0.5001-0.8659j -0.4998+0.8661j
rg60      1.0560-0.0003j -0.5220-0.9037j -0.5278+0.9147j
633       1.0134-0.0490j -0.5394-0.8806j -0.4640+0.8851j
634       0.9887-0.0596j -0.5367-0.8605j -0.4476+0.8721j
671       0.9814-0.1011j -0.5564-0.8913j -0.4216+0.8597j
645       0.0000+0.0000j -0.5351-0.8731j -0.4625+0.8873j
646       0.0000+0.0000j -0.5338-0.8710j -0.4608+0.8862j
692       0.9814-0.1011j -0.5564-0.8913j -0.4216+0.8597j
675       0.9745-0.1047j -0.5604-0.8916j -0.4210+0.8578j
611       0.0000+0.0000j  0.0000+0.0000j -0.4160+0.8579j
652       0.9740-0.0995j  0.0000+0.0000j  0.0000+0.0000j
670       1.0053-0.0657j -0.5449-0.8848j -0.4488+0.8778j
632       1.0165-0.0480j -0.5397-0.8826j -0.4653+0.8875j
680       0.9814-0.1011j -0.5564-0.8913j -0.4216+0.8597j
684       0.9794-0.1013j  0.0000+0.0000j -0.4191+0.8587j


COMPARE I
Max |diff|:
A.(fbs - dss)   36.7751
B.(fbs - dss)   26.0128
C.(fbs - dss)   38.2349
dtype: float64
                 A.(fbs - dss)    B.(fbs - dss)   C.(fbs - dss)
line_632_633   -4.2728+3.3332j   3.8126+1.4770j -0.7128-4.1695j
line_632_645    0.0000+0.0000j   8.2537+3.7933j -0.1521-3.5254j
line_632_670 -28.3968+13.5520j   9.0758+9.8847j 3.3006-30.4624j
line_645_646    0.0000+0.0000j   3.1717+1.7284j -0.1521-3.5254j
line_650_632 -32.6696+16.8851j 21.1420+15.1551j 2.4358-38.1572j
line_670_671 -27.9661+13.2568j   7.3607+8.9589j 3.5065-26.8051j
line_671_680   -0.0000-0.0000j  -0.0000+0.0000j  0.0000+0.0000j
line_671_684   -3.0871+2.5835j   0.0000+0.0000j  2.3336-3.9081j
line_671_692  -15.1628+3.6525j  -2.5439+3.6488j 1.9838-10.5645j
line_684_611    0.0000+0.0000j   0.0000+0.0000j  2.3336-3.9081j
line_684_652   -3.0871+2.5835j   0.0000+0.0000j  0.0000+0.0000j
line_692_675  -13.1240+1.4101j  -2.5439+3.6488j  2.8004-7.6471j
reg3               nan+0.0000j      nan+0.0000j     nan+0.0000j
reg3               nan+0.0000j      nan+0.0000j     nan+0.0000j
sub                nan+0.0000j      nan+0.0000j     nan+0.0000j
xfm1               nan+0.0000j      nan+0.0000j     nan+0.0000j 

FBS results
                          A               B               C
line_650_632 1.0983-0.3768j -0.6697-0.5443j -0.2181+1.2123j
line_632_670 1.0983-0.3768j -0.3623-0.3931j -0.2178+1.0797j
line_670_671 1.0813-0.3677j -0.2960-0.3539j -0.2160+0.9481j
line_671_680 0.0000+0.0000j -0.0000+0.0000j  0.0000+0.0000j
line_632_633 0.0000+0.0000j  0.0000+0.0000j  0.0000+0.0000j
line_632_645 0.0000+0.0000j -0.3074-0.1511j -0.0003+0.1326j
line_645_646 0.0000+0.0000j -0.1147-0.0666j -0.0003+0.1326j
line_692_675 0.4850+0.0100j  0.0872-0.1289j -0.1346+0.2571j
line_671_684 0.1280-0.0860j  0.0000+0.0000j -0.1023+0.1372j
line_684_611 0.0000+0.0000j  0.0000+0.0000j -0.1023+0.1372j
line_684_652 0.1280-0.0860j  0.0000+0.0000j  0.0000+0.0000j
line_671_692 0.5698-0.0647j  0.0872-0.1289j -0.1118+0.3683j
sub          0.0000+0.0000j  0.0000+0.0000j  0.0000+0.0000j
xfm1         0.0000+0.0000j  0.0000+0.0000j  0.0000+0.0000j
reg3         0.0000+0.0000j -0.0000+0.0000j  0.0000+0.0000j
reg3         0.0000+0.0000j  0.0000+0.0000j  0.0000+0.0000j 

DSS results
                            A                 B                C
line_650_632 33.7678-17.2619j -21.8118-15.6994j -2.6539+39.3695j
line_632_670 29.4951-13.9288j  -9.4381-10.2779j -3.5184+31.5421j
line_670_671 29.0474-13.6245j   -7.6567-9.3129j -3.7225+27.7533j
line_671_680   0.0000+0.0000j    0.0000-0.0000j  -0.0000-0.0000j
line_632_633   4.2728-3.3332j   -3.8126-1.4770j   0.7128+4.1695j
line_632_645   0.0000+0.0000j   -8.5611-3.9445j   0.1517+3.6580j
line_645_646   0.0000+0.0000j   -3.2863-1.7950j   0.1518+3.6580j
line_692_675  13.6090-1.4001j    2.6311-3.7777j  -2.9350+7.9043j
line_671_684   3.2151-2.6695j    0.0000+0.0000j  -2.4360+4.0453j
line_684_611   0.0000+0.0000j    0.0000+0.0000j  -2.4360+4.0453j
line_684_652   3.2151-2.6695j    0.0000+0.0000j   0.0000+0.0000j
line_671_692  15.7326-3.7172j    2.6311-3.7777j -2.0956+10.9328j


COMPARE Stx
Max |diff|:
A.(fbs - dss)   0.2883
B.(fbs - dss)   0.1530
C.(fbs - dss)   0.2359
dtype: float64
               A.(fbs - dss)   B.(fbs - dss)   C.(fbs - dss)
line_632_633 -0.1629-0.1151j -0.1216-0.0929j -0.1219-0.0931j
line_632_645  0.0000+0.0000j -0.0050-0.0028j  0.0003+0.0002j
line_632_670 -0.0105-0.0842j  0.0159+0.0186j -0.0257-0.0620j
line_645_646  0.0000+0.0000j -0.0050-0.0029j  0.0003+0.0002j
line_650_632 -0.1806-0.2248j -0.1073-0.0837j -0.1592-0.1741j
line_670_671  0.0055-0.0055j -0.0005+0.0210j  0.0090-0.0216j
line_671_680  0.0000+0.0000j -0.0000+0.0000j -0.0000+0.0000j
line_671_684  0.0045+0.0041j -0.0000+0.0000j  0.0074-0.0060j
line_671_692  0.0009-0.0069j -0.0006+0.0214j  0.0036-0.0141j
line_684_611  0.0000-0.0000j  0.0000+0.0000j  0.0078-0.0053j
line_684_652  0.0051+0.0035j  0.0000+0.0000j  0.0000+0.0000j
line_692_675 -0.0002-0.0079j -0.0006+0.0214j -0.0001-0.0173j
reg3             nan+0.0000j     nan+0.0000j     nan+0.0000j
reg3             nan+0.0000j     nan+0.0000j     nan+0.0000j
sub              nan+0.0000j     nan+0.0000j     nan+0.0000j
xfm1             nan+0.0000j     nan+0.0000j     nan+0.0000j 

FBS results
                          A               B              C
line_650_632 1.1095+0.4343j  0.8178+0.3329j 1.1941+0.4897j
line_632_670 1.0983+0.3768j  0.5283+0.1193j 1.0461+0.3559j
line_670_671 1.0942+0.4209j  0.4485+0.0825j 0.9506+0.3108j
line_671_680 0.0000+0.0000j  0.0000+0.0000j 0.0000+0.0000j
line_632_633 0.0000+0.0000j -0.0000+0.0000j 0.0000+0.0000j
line_632_645 0.0000+0.0000j  0.2881+0.1935j 0.1152+0.0666j
line_645_646 0.0000+0.0000j  0.1153+0.0662j 0.1151+0.0662j
line_692_675 0.4880-0.0080j  0.0683-0.1395j 0.2905+0.0120j
line_671_684 0.1284+0.0871j -0.0000+0.0000j 0.1703-0.0201j
line_684_611 0.0000-0.0000j  0.0000+0.0000j 0.1704-0.0196j
line_684_652 0.1288+0.0863j  0.0000+0.0000j 0.0000+0.0000j
line_671_692 0.5730+0.0675j  0.0683-0.1395j 0.3755+0.0875j
sub          0.0000+0.0000j -0.0000+0.0000j 0.0000+0.0000j
xfm1         0.0000+0.0000j -0.0000+0.0000j 0.0000+0.0000j
reg3         0.0000+0.0000j  0.0000+0.0000j 0.0000+0.0000j
reg3         0.0000+0.0000j -0.0000+0.0000j 0.0000+0.0000j 

DSS results
                           A              B              C
line_650_632  1.2901+0.6591j 0.9251+0.4166j 1.3533+0.6638j
line_632_670  1.1087+0.4609j 0.5124+0.1007j 1.0718+0.4179j
line_670_671  1.0887+0.4264j 0.4490+0.0615j 0.9417+0.3324j
line_671_680 -0.0000-0.0000j 0.0000-0.0000j 0.0000-0.0000j
line_632_633  0.1629+0.1151j 0.1216+0.0929j 0.1219+0.0931j
line_632_645  0.0000+0.0000j 0.2931+0.1963j 0.1149+0.0664j
line_645_646  0.0000+0.0000j 0.1203+0.0691j 0.1149+0.0661j
line_692_675  0.4883-0.0001j 0.0688-0.1609j 0.2906+0.0293j
line_671_684  0.1239+0.0830j 0.0000+0.0000j 0.1630-0.0141j
line_684_611  0.0000+0.0000j 0.0000+0.0000j 0.1626-0.0143j
line_684_652  0.1237+0.0828j 0.0000+0.0000j 0.0000+0.0000j
line_671_692  0.5721+0.0744j 0.0688-0.1609j 0.3720+0.1015j


COMPARE Srx
Max |diff|:
A.(fbs - dss)   0.2642
B.(fbs - dss)   0.1527
C.(fbs - dss)   0.2137
dtype: float64
               A.(fbs - dss)   B.(fbs - dss)   C.(fbs - dss)
line_632_633 -0.1625-0.1146j -0.1214-0.0926j -0.1215-0.0928j
line_632_645  0.0000+0.0000j -0.0050-0.0029j  0.0003+0.0002j
line_632_670  0.0055-0.0055j -0.0005+0.0210j  0.0090-0.0216j
line_645_646  0.0000+0.0000j -0.0050-0.0029j  0.0003+0.0002j
line_650_632 -0.1734-0.1993j -0.1107-0.0771j -0.1472-0.1549j
line_670_671  0.0054-0.0029j -0.0011+0.0211j  0.0109-0.0200j
line_671_680  0.0000-0.0000j  0.0000+0.0000j -0.0000-0.0000j
line_671_684  0.0051+0.0035j  0.0000+0.0000j  0.0078-0.0053j
line_671_692  0.0009-0.0069j -0.0006+0.0214j  0.0036-0.0141j
line_684_611  0.0000+0.0000j  0.0000+0.0000j  0.0078-0.0053j
line_684_652  0.0051+0.0034j  0.0000+0.0000j  0.0000+0.0000j
line_692_675 -0.0000-0.0079j -0.0005+0.0214j  0.0000-0.0174j
reg3             nan+0.0000j     nan+0.0000j     nan+0.0000j
reg3             nan+0.0000j     nan+0.0000j     nan+0.0000j
sub              nan+0.0000j     nan+0.0000j     nan+0.0000j
xfm1             nan+0.0000j     nan+0.0000j     nan+0.0000j 

FBS results
                          A               B              C
line_650_632 1.0983+0.3768j  0.8163+0.3128j 1.1613+0.4225j
line_632_670 1.1112+0.4309j  0.5145+0.1205j 1.0676+0.3788j
line_670_671 1.0865+0.3746j  0.4533+0.0805j 0.9308+0.2874j
line_671_680 0.0000+0.0000j  0.0000+0.0000j 0.0000+0.0000j
line_632_633 0.0000+0.0000j -0.0000+0.0000j 0.0000+0.0000j
line_632_645 0.0000+0.0000j  0.2853+0.1912j 0.1151+0.0662j
line_645_646 0.0000+0.0000j  0.1150+0.0660j 0.1150+0.0660j
line_692_675 0.4850-0.0100j  0.0680-0.1400j 0.2900+0.0120j
line_671_684 0.1288+0.0863j  0.0000+0.0000j 0.1704-0.0196j
line_684_611 0.0000+0.0000j  0.0000+0.0000j 0.1700-0.0200j
line_684_652 0.1280+0.0860j  0.0000+0.0000j 0.0000+0.0000j
line_671_692 0.5730+0.0675j  0.0683-0.1395j 0.3755+0.0875j
sub          0.0000+0.0000j -0.0000+0.0000j 0.0000+0.0000j
xfm1         0.0000+0.0000j -0.0000+0.0000j 0.0000+0.0000j
reg3         0.0000+0.0000j  0.0000+0.0000j 0.0000+0.0000j
reg3         0.0000+0.0000j -0.0000+0.0000j 0.0000+0.0000j 

DSS results
                           A               B              C
line_650_632  1.2716+0.5761j  0.9271+0.3899j 1.3085+0.5774j
line_632_670  1.1057+0.4364j  0.5150+0.0995j 1.0587+0.4004j
line_670_671  1.0811+0.3774j  0.4544+0.0594j 0.9199+0.3075j
line_671_680 -0.0000+0.0000j -0.0000-0.0000j 0.0000+0.0000j
line_632_633  0.1625+0.1146j  0.1214+0.0926j 0.1215+0.0928j
line_632_645  0.0000+0.0000j  0.2903+0.1940j 0.1149+0.0661j
line_645_646  0.0000+0.0000j  0.1200+0.0689j 0.1147+0.0658j
line_692_675  0.4850-0.0021j  0.0685-0.1614j 0.2900+0.0294j
line_671_684  0.1237+0.0828j  0.0000+0.0000j 0.1626-0.0143j
line_684_611  0.0000+0.0000j  0.0000+0.0000j 0.1622-0.0147j
line_684_652  0.1229+0.0826j  0.0000+0.0000j 0.0000+0.0000j
line_671_692  0.5721+0.0744j  0.0688-0.1609j 0.3720+0.1015j
F

=================================== FAILURES ===================================
___________________________________ test_all ___________________________________

    def test_all():
        """
        Compare the python FBS solution to the opendss solution.
        To save output, run from command line:
        pytest ./fbs/tests/test_compare_opendss.py -s >[OUTPUT FILE PATH]
        Examples:
        $ pytest ./fbs/tests/test_compare_opendss.py -s > ./fbs/tests/06n3ph_unbal/06n3ph_out.txt
        $ pytest ./fbs/tests/test_compare_opendss.py -s > ./fbs/tests/05n3ph_unbal/05n3ph_out.txt
        """
        tolerance = .01
        for file in dss_files:
            print(f'\n\nTesting File: {file}')
>           compare_fbs_sol(file, tolerance)

fbs/tests/test_compare_opendss.py:32: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dss_file = 'fbs/tests/IEEE_13_bus/IEEE_13_Bus_allwye.dss', tolerance = 0.01

    def compare_fbs_sol(dss_file, tolerance):
        #TODO: Figure out how to get Inode (iNR) and sV (sNR) at each node from dss and perform a compare
        # solve with fbs
        network = init_from_dss(dss_file)
        fbs_sol = get_fbs_solution(fbs(network))
    
        # solve with dss
        dss_sol = solve_with_dss(dss_file)
    
        fbsV, fbsI, fbsStx, fbsSrx = fbs_sol.V_df(), fbs_sol.I_df(), fbs_sol.Stx_df(), fbs_sol.Srx_df()
        dssV, dssI, dssStx, dssSrx = dss_sol
        print(f"FBS iterations: {fbs_sol.iterations}\t FBS convergence:{fbs_sol.diff}\t FBS tolerance: {fbs_sol.tolerance}")
        print("\n\nCOMPARE V")
        V_maxDiff = compare_dfs(fbsV, dssV)
        print("\n\nCOMPARE I")
        I_maxDiff = compare_dfs(fbsI, dssI)
        print("\n\nCOMPARE Stx")
        Stx_maxDiff = compare_dfs(fbsStx, dssStx)
        print("\n\nCOMPARE Srx")
        Srx_maxDiff = compare_dfs(fbsSrx, dssSrx)
    
>       assert (V_maxDiff <= tolerance).all()
E       assert False
E        +  where False = <bound method Series.all of A.(fbs - dss)    False\nB.(fbs - dss)    False\nC.(fbs - dss)    False\ndtype: bool>()
E        +    where <bound method Series.all of A.(fbs - dss)    False\nB.(fbs - dss)    False\nC.(fbs - dss)    False\ndtype: bool> = A.(fbs - dss)   0.1082\nB.(fbs - dss)   0.0656\nC.(fbs - dss)   0.0844\ndtype: float64 <= 0.01.all

fbs/tests/test_compare_opendss.py:56: AssertionError
=============================== warnings summary ===============================
tests/test_compare_opendss.py::test_all
  /Users/elainelaguerta/Dropbox/LBNL/LinDist3Flow/fbs/fbs/solution.py:171: RuntimeWarning: invalid value encountered in true_divide
    new_line_I = np.conj(np.divide(node_s, node_V))

tests/test_compare_opendss.py::test_all
  /Users/elainelaguerta/Dropbox/LBNL/LinDist3Flow/fbs/fbs/solution.py:220: RuntimeWarning: invalid value encountered in true_divide
    node_I = np.conj(np.divide(node_sV,node_V))

-- Docs: https://docs.pytest.org/en/stable/warnings.html
=========================== short test summary info ============================
FAILED fbs/tests/test_compare_opendss.py::test_all - assert False
======================== 1 failed, 2 warnings in 1.25s =========================
