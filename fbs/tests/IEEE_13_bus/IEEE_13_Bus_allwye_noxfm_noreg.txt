============================= test session starts ==============================
platform darwin -- Python 3.7.4, pytest-6.0.1, py-1.9.0, pluggy-0.13.1
rootdir: /Users/elainelaguerta/Dropbox/LBNL/LinDist3Flow/fbs
collected 1 item

fbs/tests/test_compare_opendss.py 

Testing File: fbs/tests/IEEE_13_bus/IEEE_13_Bus_allwye_noxfm_noreg.dss

Opendss Iterations: 4	Opendss Convergence: 0.0001
OpenDSS Loads after solving, from dss.CktElement.Powers():
[534.0570967258333, 81.55330098148316, 68.30875320138719, -141.4580462309893, 336.9758020400831, 95.33114698654596, -534.0570907931843, -81.55330098148318, -68.30875277581745, 141.45804623098928, -336.97579943442656, -95.33114698654596]
FBS iterations: 12	 FBS convergence:9.251692167849716e-10	 FBS tolerance: 1e-09

COMPARE V
Max |diff|:
A.(fbs - dss)    0.013897
B.(fbs - dss)    0.011121
C.(fbs - dss)    0.026542
dtype: float64
                A.(fbs - dss)       B.(fbs - dss)       C.(fbs - dss)
sourcebus  0.000141+0.000153j  0.000055-0.000145j -0.000205+0.000037j
671        0.002048-0.013245j  0.004546-0.009906j  0.018740-0.016107j
634        0.001306-0.006824j  0.002438-0.005371j  0.010083-0.008719j
645        0.000000+0.000000j  0.002340-0.005328j  0.009977-0.008678j
646        0.000000+0.000000j  0.002331-0.005338j  0.010005-0.008756j
692        0.002048-0.013245j  0.004546-0.009906j  0.018740-0.016107j
675        0.001768-0.013784j  0.004559-0.010144j  0.019189-0.016342j
611        0.000000+0.000000j  0.000000+0.000000j  0.018780-0.018757j
652        0.001570-0.013314j  0.000000+0.000000j -0.000000+0.000000j
670        0.001558-0.009000j  0.003170-0.006888j  0.012992-0.011132j
650        0.000194-0.000179j  0.000168-0.000392j  0.000278-0.000372j
632        0.001248-0.006830j  0.002427-0.005327j  0.009939-0.008541j
680        0.002048-0.013245j  0.004546-0.009906j  0.018740-0.016107j
633        0.001277-0.006827j  0.002432-0.005349j  0.010011-0.008630j
684        0.001959-0.013546j  0.000000+0.000000j  0.018731-0.017439j
FBS results
                            A                   B                   C
sourcebus  1.000000-0.000000j -0.500000-0.866025j -0.500000+0.866025j
671        0.920120-0.113212j -0.533292-0.856024j -0.377309+0.795727j
634        0.950436-0.057474j -0.516906-0.841154j -0.424037+0.825057j
645        0.000000+0.000000j -0.512760-0.835622j -0.423855+0.829597j
646        0.000000+0.000000j -0.511447-0.833507j -0.422109+0.828308j
692        0.920120-0.113212j -0.533292-0.856024j -0.377309+0.795727j
675        0.912927-0.117061j -0.537142-0.856356j -0.376350+0.793768j
611        0.000000+0.000000j  0.000000+0.000000j -0.371888+0.791086j
652        0.912013-0.111561j  0.000000+0.000000j -0.000000+0.000000j
670        0.945103-0.074650j -0.522294-0.848185j -0.408297+0.818052j
650        0.997944-0.002635j -0.500832-0.865041j -0.496516+0.864308j
632        0.956832-0.055330j -0.517476-0.845352j -0.426829+0.829968j
680        0.920120-0.113212j -0.533292-0.856024j -0.377309+0.795727j
633        0.953634-0.056402j -0.517191-0.843253j -0.425433+0.827513j
684        0.917966-0.113725j  0.000000+0.000000j -0.374976+0.793231j
DSS results
                            A                   B                   C
sourcebus  0.999859-0.000153j -0.500055-0.865880j -0.499795+0.865989j
671        0.918072-0.099967j -0.537839-0.846118j -0.396049+0.811834j
634        0.949130-0.050650j -0.519344-0.835783j -0.434120+0.833777j
645        0.000000+0.000000j -0.515101-0.830295j -0.433831+0.838275j
646        0.000000+0.000000j -0.513777-0.828169j -0.432114+0.837064j
692        0.918072-0.099967j -0.537839-0.846118j -0.396049+0.811834j
675        0.911159-0.103276j -0.541700-0.846211j -0.395539+0.810110j
611        0.000000+0.000000j  0.000000+0.000000j -0.390668+0.809843j
652        0.910443-0.098247j  0.000000+0.000000j  0.000000+0.000000j
670        0.943545-0.065650j -0.525464-0.841297j -0.421289+0.829184j
650        0.997750-0.002455j -0.501000-0.864649j -0.496794+0.864680j
632        0.955584-0.048500j -0.519903-0.840025j -0.436768+0.838509j
680        0.918072-0.099967j -0.537839-0.846118j -0.396049+0.811834j
633        0.952357-0.049575j -0.519623-0.837904j -0.435444+0.836143j
684        0.916007-0.100180j  0.000000+0.000000j -0.393707+0.810670j

COMPARE I
Max |diff|:
A.(fbs - dss)    0.070170
B.(fbs - dss)    0.006510
C.(fbs - dss)    0.181824
dtype: float64
                   A.(fbs - dss)       B.(fbs - dss)       C.(fbs - dss)
line_sbs_650  0.063083-0.029122j  0.006326-0.001535j  0.038066+0.177794j
line_650_632  0.063083-0.029122j  0.006326-0.001535j  0.038066+0.177794j
line_632_670  0.064255-0.028197j  0.003775+0.000046j  0.035398+0.168293j
line_670_671  0.064274-0.027973j  0.003259+0.000321j  0.033852+0.159711j
line_671_680 -0.000000-0.000001j -0.000001+0.000001j  0.000001+0.000001j
line_632_633 -0.001172-0.000922j  0.000751-0.000516j  0.001725+0.005186j
line_633_634 -0.001172-0.000922j  0.000752-0.000517j  0.001724+0.005185j
line_632_645  0.000000+0.000000j  0.001802-0.001066j  0.000941+0.004314j
line_645_646  0.000000+0.000000j  0.000727-0.000363j  0.000941+0.004314j
line_692_675  0.036567+0.008197j -0.000943+0.002611j -0.029929+0.031563j
line_671_684  0.007442-0.009453j  0.000000+0.000000j  0.048475+0.051516j
line_684_611  0.000000+0.000000j  0.000000+0.000000j  0.048474+0.051515j
line_684_652  0.007442-0.009453j  0.000000+0.000000j  0.000000+0.000000j
line_671_692  0.039762+0.002120j -0.000943+0.002611j -0.024260+0.046528j
FBS results
                               A                   B                   C
line_sbs_650  1.293023-0.681725j -0.832331-0.577525j -0.045333+1.578415j
line_650_632  1.293023-0.681725j -0.832331-0.577525j -0.045333+1.578415j
line_632_670  1.132266-0.556268j -0.372641-0.375654j -0.079579+1.276564j
line_670_671  1.115221-0.544341j -0.305415-0.339238j -0.088978+1.128850j
line_671_680  0.000000+0.000000j -0.000000+0.000000j  0.000000+0.000000j
line_632_633  0.160757-0.125457j -0.141303-0.055828j  0.027159+0.159403j
line_633_634  0.160757-0.125457j -0.141303-0.055828j  0.027159+0.159403j
line_632_645  0.000000+0.000000j -0.318388-0.146043j  0.007088+0.142449j
line_645_646  0.000000+0.000000j -0.119028-0.064935j  0.007088+0.142449j
line_692_675  0.524046-0.056243j  0.081580-0.130577j -0.129086+0.304142j
line_671_684  0.126915-0.109822j  0.000000+0.000000j -0.034424+0.198712j
line_684_611  0.000000+0.000000j  0.000000+0.000000j -0.034424+0.198712j
line_684_652  0.126915-0.109822j  0.000000+0.000000j  0.000000+0.000000j
line_671_692  0.605102-0.148270j  0.081580-0.130577j -0.092974+0.428086j
DSS results
                               A                   B                   C
line_sbs_650  1.229941-0.652603j -0.838657-0.575990j -0.083399+1.400621j
line_650_632  1.229941-0.652603j -0.838658-0.575990j -0.083399+1.400621j
line_632_670  1.068011-0.528071j -0.376416-0.375700j -0.114977+1.108270j
line_670_671  1.050947-0.516367j -0.308674-0.339558j -0.122830+0.969139j
line_671_680  0.000000+0.000001j  0.000001-0.000001j -0.000001-0.000001j
line_632_633  0.161929-0.124535j -0.142054-0.055311j  0.025434+0.154217j
line_633_634  0.161929-0.124536j -0.142055-0.055311j  0.025434+0.154217j
line_632_645  0.000000+0.000000j -0.320189-0.144977j  0.006147+0.138135j
line_645_646  0.000000+0.000000j -0.119755-0.064572j  0.006147+0.138136j
line_692_675  0.487479-0.064440j  0.082523-0.133188j -0.099157+0.272579j
line_671_684  0.119473-0.100368j  0.000000+0.000000j -0.082898+0.147196j
line_684_611  0.000000+0.000000j  0.000000+0.000000j -0.082898+0.147197j
line_684_652  0.119473-0.100369j  0.000000+0.000000j  0.000000+0.000000j
line_671_692  0.565340-0.150390j  0.082523-0.133188j -0.068714+0.381558j

COMPARE Stx
Max |diff|:
A.(fbs - dss)    0.070327
B.(fbs - dss)    0.006352
C.(fbs - dss)    0.182065
dtype: float64
                   A.(fbs - dss)       B.(fbs - dss)       C.(fbs - dss)
line_sbs_650  0.063157+0.029403j -0.001796-0.006093j  0.135010+0.122148j
line_650_632  0.063386+0.028802j -0.001755-0.005816j  0.134225+0.120820j
line_632_670  0.067980+0.016789j -0.000904-0.000251j  0.113961+0.091179j
line_670_671  0.069118+0.012985j -0.000614+0.000606j  0.104446+0.081679j
line_671_680  0.000000+0.000001j -0.000000+0.000001j -0.000000+0.000001j
line_632_633 -0.000018-0.000003j -0.000002-0.000011j  0.002503+0.001895j
line_633_634 -0.000009-0.000001j -0.000003-0.000007j  0.002481+0.001870j
line_632_645  0.000000-0.000000j -0.000036-0.000017j  0.002060+0.001197j
line_645_646  0.000000+0.000000j -0.000005-0.000004j  0.002042+0.001177j
line_692_675  0.034570-0.018007j -0.000038+0.001988j  0.030160-0.015417j
line_671_684  0.009492+0.006479j -0.000000+0.000000j  0.018778+0.056587j
line_684_611  0.000000-0.000000j  0.000000+0.000000j  0.018567+0.056457j
line_684_652  0.009500+0.006410j  0.000000+0.000000j  0.000000+0.000000j
line_671_692  0.039496-0.013632j -0.000038+0.001988j  0.038744-0.007792j
FBS results
                               A                   B                   C
line_sbs_650  1.293023+0.681725j  0.916317+0.432058j  1.389614+0.749949j
line_650_632  1.292162+0.676917j  0.916442+0.430758j  1.386746+0.744527j
line_632_670  1.114166+0.469607j  0.510393+0.120621j  1.093473+0.478827j
line_670_671  1.094634+0.431207j  0.447252+0.081866j  0.959787+0.388118j
line_671_680  0.000000-0.000000j  0.000000+0.000000j  0.000000+0.000000j
line_632_633  0.160759+0.111147j  0.120315+0.090561j  0.120707+0.090579j
line_633_634  0.160380+0.110574j  0.120157+0.090281j  0.120353+0.090289j
line_632_645  0.000000-0.000000j  0.288216+0.193576j  0.115203+0.066684j
line_645_646  0.000000+0.000000j  0.115294+0.066166j  0.115171+0.066258j
line_692_675  0.488553-0.007578j  0.068271-0.139470j  0.290719+0.012039j
line_671_684  0.129210+0.086681j -0.000000+0.000000j  0.171109+0.047584j
line_684_611  0.000000-0.000000j  0.000000+0.000000j  0.170532+0.047206j
line_684_652  0.128993+0.086379j  0.000000+0.000000j  0.000000+0.000000j
line_671_692  0.573553+0.067922j  0.068271-0.139470j  0.375719+0.087539j
DSS results
                               A                   B                   C
line_sbs_650  1.229866+0.652322j  0.918113+0.438150j  1.254604+0.627801j
line_650_632  1.228776+0.648115j  0.918197+0.436573j  1.252521+0.623706j
line_632_670  1.046186+0.452818j  0.511297+0.120871j  0.979513+0.387648j
line_670_671  1.025515+0.418222j  0.447866+0.081261j  0.855341+0.306439j
line_671_680 -0.000000-0.000001j  0.000000-0.000001j  0.000000-0.000001j
line_632_633  0.160777+0.111150j  0.120317+0.090573j  0.118204+0.088683j
line_633_634  0.160388+0.110575j  0.120160+0.090288j  0.117872+0.088420j
line_632_645  0.000000+0.000000j  0.288252+0.193593j  0.113143+0.065487j
line_645_646  0.000000+0.000000j  0.115299+0.066171j  0.113129+0.065081j
line_692_675  0.453983+0.010429j  0.068309-0.141458j  0.260560+0.027456j
line_671_684  0.119719+0.080202j  0.000000+0.000000j  0.152331-0.009003j
line_684_611  0.000000+0.000000j  0.000000+0.000000j  0.151965-0.009251j
line_684_652  0.119493+0.079970j  0.000000+0.000000j  0.000000+0.000000j
line_671_692  0.534057+0.081553j  0.068309-0.141458j  0.336976+0.095331j

COMPARE Srx
Max |diff|:
A.(fbs - dss)    0.071518
B.(fbs - dss)    0.006075
C.(fbs - dss)    0.180593
dtype: float64
                           A.(fbs - dss)  ...       C.(fbs - dss)
line_sbs_650  6.338581e-02+2.880206e-02j  ...  0.134225+0.120820j
line_650_632  6.796232e-02+1.678614e-02j  ...  0.118524+0.094271j
line_632_670  6.924912e-02+1.306186e-02j  ...  0.109389+0.084552j
line_670_671  7.129898e-02+5.598070e-03j  ...  0.096402+0.071013j
line_671_680 -9.331965e-15-1.115917e-14j  ...  0.000000+0.000000j
line_632_633 -8.935483e-06-1.489228e-06j  ...  0.002481+0.001870j
line_633_634  2.067557e-07+2.883061e-07j  ...  0.002459+0.001844j
line_632_645  0.000000e+00+0.000000e+00j  ...  0.002042+0.001177j
line_645_646  0.000000e+00+0.000000e+00j  ...  0.002028+0.001164j
line_692_675  3.417347e-02-1.843664e-02j  ...  0.029960-0.015552j
line_671_684  9.499945e-03+6.409516e-03j  ...  0.018567+0.056457j
line_684_611  0.000000e+00+0.000000e+00j  ...  0.018408+0.056296j
line_684_652  9.365444e-03+6.292560e-03j  ...  0.000000+0.000000j
line_671_692  3.949597e-02-1.363177e-02j  ...  0.038744-0.007792j

[14 rows x 3 columns]
FBS results
                               A                   B                   C
line_sbs_650  1.292162+0.676917j  0.916442+0.430758j  1.386746+0.744527j
line_650_632  1.274926+0.580754j  0.918924+0.404758j  1.329383+0.636090j
line_632_670  1.111634+0.441207j  0.513252+0.119866j  1.076787+0.456118j
line_670_671  1.087763+0.374602j  0.453271+0.080530j  0.931828+0.355123j
line_671_680  0.000000-0.000000j  0.000000+0.000000j  0.000000+0.000000j
line_632_633  0.160380+0.110574j  0.120157+0.090281j  0.120353+0.090289j
line_633_634  0.160000+0.110000j  0.120000+0.090000j  0.120000+0.090000j
line_632_645  0.000000+0.000000j  0.285294+0.191166j  0.115171+0.066258j
line_645_646  0.000000+0.000000j  0.115000+0.066000j  0.115000+0.066000j
line_692_675  0.485000-0.010000j  0.068000-0.140000j  0.290000+0.012000j
line_671_684  0.128993+0.086379j  0.000000+0.000000j  0.170532+0.047206j
line_684_611  0.000000+0.000000j  0.000000+0.000000j  0.170000+0.046667j
line_684_652  0.128000+0.086000j  0.000000+0.000000j  0.000000+0.000000j
line_671_692  0.573553+0.067922j  0.068271-0.139470j  0.375719+0.087539j
DSS results
                                       A  ...                   C
line_sbs_650  1.228776e+00+6.481150e-01j  ...  1.252521+0.623706j
line_650_632  1.206963e+00+5.639679e-01j  ...  1.210859+0.541819j
line_632_670  1.042385e+00+4.281451e-01j  ...  0.967398+0.371566j
line_670_671  1.016464e+00+3.690042e-01j  ...  0.835426+0.284110j
line_671_680  9.331965e-15+1.115917e-14j  ... -0.000000-0.000000j
line_632_633  1.603885e-01+1.105750e-01j  ...  0.117872+0.088420j
line_633_634  1.599998e-01+1.099997e-01j  ...  0.117541+0.088156j
line_632_645  0.000000e+00+0.000000e+00j  ...  0.113129+0.065081j
line_645_646  0.000000e+00+0.000000e+00j  ...  0.112972+0.064836j
line_692_675  4.508265e-01+8.436636e-03j  ...  0.260040+0.027552j
line_671_684  1.194933e-01+7.996960e-02j  ...  0.151965-0.009251j
line_684_611  0.000000e+00+0.000000e+00j  ...  0.151592-0.009629j
line_684_652  1.186346e-01+7.970744e-02j  ...  0.000000+0.000000j
line_671_692  5.340571e-01+8.155330e-02j  ...  0.336976+0.095331j

[14 rows x 3 columns]
F

=================================== FAILURES ===================================
___________________________________ test_all ___________________________________

    def test_all():
        """
        Compare the python FBS solution to the opendss solution.
        To save output, run from command line:
        pytest ./fbs/tests/test_compare_opendss.py -s >[OUTPUT FILE PATH]
        Examples:
        $ pytest ./fbs/tests/test_compare_opendss.py -s > ./fbs/tests/06n3ph_unbal/06n3ph_out.txt
        $ pytest ./fbs/tests/test_compare_opendss.py -s > ./fbs/tests/05n3ph_unbal/05n3ph_out.txt
        """
        tolerance = .01
        for file in dss_files:
            print(f'\n\nTesting File: {file}')
>           compare_fbs_sol(file, tolerance)

fbs/tests/test_compare_opendss.py:29: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dss_file = 'fbs/tests/IEEE_13_bus/IEEE_13_Bus_allwye_noxfm_noreg.dss'
tolerance = 0.01

    def compare_fbs_sol(dss_file, tolerance):
        #TODO: Figure out how to get Inode (iNR) and sV (sNR) at each node from dss and perform a compare
        # solve with fbs
        network = init_from_dss(dss_file)
        fbs_sol = get_fbs_solution(fbs(network))
    
        # solve with dss
        dss_sol = solve_with_dss(dss_file)
    
        fbsV, fbsI, fbsStx, fbsSrx = fbs_sol.V_df(), fbs_sol.I_df(), fbs_sol.Stx_df(), fbs_sol.Srx_df()
        dssV, dssI, dssStx, dssSrx = dss_sol
        print(f"FBS iterations: {fbs_sol.iterations}\t FBS convergence:{fbs_sol.diff}\t FBS tolerance: {fbs_sol.tolerance}")
        print("\nCOMPARE V")
        V_maxDiff = compare_dfs(fbsV, dssV)
        print("\nCOMPARE I")
        I_maxDiff = compare_dfs(fbsI, dssI)
        print("\nCOMPARE Stx")
        Stx_maxDiff = compare_dfs(fbsStx, dssStx)
        print("\nCOMPARE Srx")
        Srx_maxDiff = compare_dfs(fbsSrx, dssSrx)
    
>       assert (V_maxDiff <= tolerance).all()
E       assert False
E        +  where False = <bound method Series.all of A.(fbs - dss)    False\nB.(fbs - dss)    False\nC.(fbs - dss)    False\ndtype: bool>()
E        +    where <bound method Series.all of A.(fbs - dss)    False\nB.(fbs - dss)    False\nC.(fbs - dss)    False\ndtype: bool> = A.(fbs - dss)    0.013897\nB.(fbs - dss)    0.011121\nC.(fbs - dss)    0.026542\ndtype: float64 <= 0.01.all

fbs/tests/test_compare_opendss.py:53: AssertionError
=============================== warnings summary ===============================
tests/test_compare_opendss.py::test_all
  /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages/opendssdirect/utils.py:71: UserWarning: Empty list (opendssdirect.Transformers)
    warnings.warn("Empty list ({class_name})".format(class_name=class_name))

tests/test_compare_opendss.py::test_all
  /Users/elainelaguerta/Dropbox/LBNL/LinDist3Flow/fbs/fbs/solution.py:156: RuntimeWarning: invalid value encountered in true_divide
    new_line_I = np.conj(np.divide(node_s, node_V)) # TODO: consider dividing manually only by phases on the node

tests/test_compare_opendss.py::test_all
  /Users/elainelaguerta/Dropbox/LBNL/LinDist3Flow/fbs/fbs/solution.py:203: RuntimeWarning: invalid value encountered in true_divide
    node_I = np.conj(np.divide(node_sV,node_V))

-- Docs: https://docs.pytest.org/en/stable/warnings.html
=========================== short test summary info ============================
FAILED fbs/tests/test_compare_opendss.py::test_all - assert False
======================== 1 failed, 3 warnings in 0.76s =========================
