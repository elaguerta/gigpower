============================= test session starts ==============================
platform darwin -- Python 3.8.5, pytest-6.0.1, py-1.9.0, pluggy-0.13.1
rootdir: /Users/elainelaguerta/Dropbox/LBNL/LinDist3Flow/fbs
collected 1 item

fbs/tests/test_compare_opendss.py 

Testing File: fbs/tests/IEEE_13_bus/IEEE_13_Bus_allwye_noxfm_noreg.dss

Opendss Iterations: 4	Opendss Convergence: 0.0001
OpenDSS Loads after solving, from dss.CktElement.Powers():
[534.0570967258333, 81.55330098148316, 68.30875320138719, -141.4580462309893, 336.9758020400831, 95.33114698654596, -534.0570907931843, -81.55330098148318, -68.30875277581745, 141.45804623098928, -336.97579943442656, -95.33114698654596]
FBS iterations: 12	 FBS convergence:3.443972288919555e-10	 FBS tolerance: 1e-09


COMPARE V
Max |diff|:
A.(fbs - dss)   0.0097
B.(fbs - dss)   0.0069
C.(fbs - dss)   0.0168
dtype: float64
           A.(fbs - dss)  B.(fbs - dss)   C.(fbs - dss)
sourcebus 0.0001+0.0002j 0.0001-0.0001j -0.0002+0.0000j
671       0.0011-0.0091j 0.0037-0.0056j  0.0152-0.0051j
634       0.0008-0.0047j 0.0020-0.0031j  0.0081-0.0030j
645       0.0000+0.0000j 0.0019-0.0030j  0.0080-0.0030j
646       0.0000+0.0000j 0.0019-0.0030j  0.0081-0.0030j
692       0.0011-0.0091j 0.0037-0.0056j  0.0152-0.0051j
675       0.0008-0.0097j 0.0037-0.0058j  0.0156-0.0053j
611       0.0000+0.0000j 0.0000+0.0000j  0.0160-0.0051j
652       0.0006-0.0089j 0.0000+0.0000j -0.0000+0.0000j
670       0.0009-0.0062j 0.0026-0.0039j  0.0105-0.0037j
650       0.0002-0.0001j 0.0001-0.0003j  0.0002-0.0001j
632       0.0007-0.0047j 0.0020-0.0031j  0.0080-0.0029j
680       0.0011-0.0091j 0.0037-0.0056j  0.0152-0.0051j
633       0.0008-0.0047j 0.0020-0.0031j  0.0081-0.0029j
684       0.0010-0.0091j 0.0000+0.0000j  0.0156-0.0051j 

FBS results
                       A               B               C
sourcebus 1.0000-0.0000j -0.5000-0.8660j -0.5000+0.8660j
671       0.9192-0.1091j -0.5341-0.8517j -0.3809+0.8067j
634       0.9499-0.0554j -0.5173-0.8389j -0.4260+0.8308j
645       0.0000+0.0000j -0.5132-0.8333j -0.4258+0.8353j
646       0.0000+0.0000j -0.5119-0.8312j -0.4241+0.8340j
692       0.9192-0.1091j -0.5341-0.8517j -0.3809+0.8067j
675       0.9120-0.1130j -0.5380-0.8520j -0.3800+0.8048j
611       0.0000+0.0000j  0.0000+0.0000j -0.3746+0.8048j
652       0.9110-0.1071j  0.0000+0.0000j -0.0000+0.0000j
670       0.9444-0.0719j -0.5229-0.8452j -0.4108+0.8255j
650       0.9979-0.0025j -0.5009-0.8649j -0.4966+0.8646j
632       0.9563-0.0532j -0.5179-0.8431j -0.4287+0.8356j
680       0.9192-0.1091j -0.5341-0.8517j -0.3809+0.8067j
633       0.9531-0.0543j -0.5176-0.8410j -0.4274+0.8332j
684       0.9170-0.1093j  0.0000+0.0000j -0.3781+0.8056j 

DSS results
                       A               B               C
sourcebus 0.9999-0.0002j -0.5001-0.8659j -0.4998+0.8660j
671       0.9181-0.1000j -0.5378-0.8461j -0.3960+0.8118j
634       0.9491-0.0506j -0.5193-0.8358j -0.4341+0.8338j
645       0.0000+0.0000j -0.5151-0.8303j -0.4338+0.8383j
646       0.0000+0.0000j -0.5138-0.8282j -0.4321+0.8371j
692       0.9181-0.1000j -0.5378-0.8461j -0.3960+0.8118j
675       0.9112-0.1033j -0.5417-0.8462j -0.3955+0.8101j
611       0.0000+0.0000j  0.0000+0.0000j -0.3907+0.8098j
652       0.9104-0.0982j  0.0000+0.0000j  0.0000+0.0000j
670       0.9435-0.0656j -0.5255-0.8413j -0.4213+0.8292j
650       0.9978-0.0025j -0.5010-0.8646j -0.4968+0.8647j
632       0.9556-0.0485j -0.5199-0.8400j -0.4368+0.8385j
680       0.9181-0.1000j -0.5378-0.8461j -0.3960+0.8118j
633       0.9524-0.0496j -0.5196-0.8379j -0.4354+0.8361j
684       0.9160-0.1002j  0.0000+0.0000j -0.3937+0.8107j


COMPARE I
Max |diff|:
A.(fbs - dss)   0.0726
B.(fbs - dss)   0.0032
C.(fbs - dss)   0.1307
dtype: float64
               A.(fbs - dss)   B.(fbs - dss)   C.(fbs - dss)
line_sbs_650  0.0677-0.0249j  0.0030-0.0013j -0.0264+0.1281j
line_650_632  0.0677-0.0249j  0.0030-0.0013j -0.0264+0.1281j
line_632_670  0.0684-0.0242j  0.0015-0.0001j -0.0291+0.1205j
line_670_671  0.0684-0.0240j  0.0013+0.0002j -0.0307+0.1132j
line_671_680 -0.0000-0.0000j -0.0000+0.0000j  0.0000+0.0000j
line_632_633 -0.0008-0.0007j  0.0004-0.0004j  0.0017+0.0041j
line_633_634 -0.0008-0.0007j  0.0004-0.0004j  0.0017+0.0041j
line_632_645  0.0000+0.0000j  0.0010-0.0008j  0.0010+0.0034j
line_645_646  0.0000+0.0000j  0.0004-0.0003j  0.0010+0.0034j
line_692_675  0.0376+0.0104j -0.0011+0.0019j -0.0278+0.0278j
line_671_684  0.0082-0.0090j  0.0000+0.0000j -0.0183+0.0169j
line_684_611  0.0000+0.0000j  0.0000+0.0000j -0.0183+0.0169j
line_684_652  0.0082-0.0090j  0.0000+0.0000j  0.0000+0.0000j
line_671_692  0.0414+0.0045j -0.0011+0.0019j -0.0224+0.0411j 

FBS results
                          A               B               C
line_sbs_650 1.2976-0.6775j -0.8357-0.5773j -0.1098+1.5287j
line_650_632 1.2976-0.6775j -0.8357-0.5773j -0.1098+1.5287j
line_632_670 1.1365-0.5523j -0.3749-0.3758j -0.1441+1.2288j
line_670_671 1.1194-0.5404j -0.3074-0.3394j -0.1536+1.0823j
line_671_680 0.0000+0.0000j -0.0000+0.0000j  0.0000+0.0000j
line_632_633 0.1611-0.1252j -0.1416-0.0557j  0.0271+0.1584j
line_633_634 0.1611-0.1252j -0.1416-0.0557j  0.0271+0.1584j
line_632_645 0.0000+0.0000j -0.3192-0.1458j  0.0072+0.1415j
line_645_646 0.0000+0.0000j -0.1193-0.0649j  0.0072+0.1415j
line_692_675 0.5251-0.0541j  0.0814-0.1312j -0.1269+0.3004j
line_671_684 0.1276-0.1094j  0.0000+0.0000j -0.1012+0.1641j
line_684_611 0.0000+0.0000j  0.0000+0.0000j -0.1012+0.1641j
line_684_652 0.1276-0.1094j  0.0000+0.0000j  0.0000+0.0000j
line_671_692 0.6067-0.1459j  0.0814-0.1312j -0.0911+0.4227j 

DSS results
                          A               B               C
line_sbs_650 1.2299-0.6526j -0.8387-0.5760j -0.0834+1.4006j
line_650_632 1.2299-0.6526j -0.8387-0.5760j -0.0834+1.4006j
line_632_670 1.0680-0.5281j -0.3764-0.3757j -0.1150+1.1083j
line_670_671 1.0509-0.5164j -0.3087-0.3396j -0.1228+0.9691j
line_671_680 0.0000+0.0000j  0.0000-0.0000j -0.0000-0.0000j
line_632_633 0.1619-0.1245j -0.1421-0.0553j  0.0254+0.1542j
line_633_634 0.1619-0.1245j -0.1421-0.0553j  0.0254+0.1542j
line_632_645 0.0000+0.0000j -0.3202-0.1450j  0.0061+0.1381j
line_645_646 0.0000+0.0000j -0.1198-0.0646j  0.0061+0.1381j
line_692_675 0.4875-0.0644j  0.0825-0.1332j -0.0992+0.2726j
line_671_684 0.1195-0.1004j  0.0000+0.0000j -0.0829+0.1472j
line_684_611 0.0000+0.0000j  0.0000+0.0000j -0.0829+0.1472j
line_684_652 0.1195-0.1004j  0.0000+0.0000j  0.0000+0.0000j
line_671_692 0.5653-0.1504j  0.0825-0.1332j -0.0687+0.3816j


COMPARE Stx
Max |diff|:
A.(fbs - dss)   0.0722
B.(fbs - dss)   0.0031
C.(fbs - dss)   0.1309
dtype: float64
               A.(fbs - dss)   B.(fbs - dss)   C.(fbs - dss)
line_sbs_650  0.0677+0.0251j -0.0003-0.0030j  0.1242+0.0415j
line_650_632  0.0678+0.0246j -0.0003-0.0029j  0.1237+0.0405j
line_632_670  0.0700+0.0148j -0.0003+0.0006j  0.1091+0.0188j
line_670_671  0.0705+0.0117j -0.0002+0.0011j  0.1012+0.0114j
line_671_680  0.0000+0.0000j -0.0000+0.0000j -0.0000+0.0000j
line_632_633 -0.0000-0.0000j -0.0000-0.0000j  0.0025+0.0019j
line_633_634 -0.0000-0.0000j -0.0000-0.0000j  0.0025+0.0019j
line_632_645  0.0000-0.0000j -0.0000-0.0000j  0.0021+0.0012j
line_645_646  0.0000+0.0000j -0.0000-0.0000j  0.0020+0.0012j
line_692_675  0.0346-0.0180j -0.0000+0.0020j  0.0301-0.0154j
line_671_684  0.0095+0.0064j -0.0000+0.0000j  0.0186-0.0102j
line_684_611  0.0000-0.0000j  0.0000+0.0000j  0.0185-0.0103j
line_684_652  0.0095+0.0064j  0.0000+0.0000j  0.0000+0.0000j
line_671_692  0.0395-0.0136j -0.0000+0.0020j  0.0387-0.0078j 

FBS results
                          A               B              C
line_sbs_650 1.2976+0.6775j  0.9178+0.4351j 1.3788+0.6693j
line_650_632 1.2966+0.6728j  0.9178+0.4337j 1.3762+0.6643j
line_632_670 1.1162+0.4677j  0.5110+0.1214j 1.0886+0.4064j
line_670_671 1.0960+0.4299j  0.4476+0.0824j 0.9566+0.3178j
line_671_680 0.0000-0.0000j  0.0000+0.0000j 0.0000+0.0000j
line_632_633 0.1608+0.1111j  0.1203+0.0906j 0.1207+0.0906j
line_633_634 0.1604+0.1106j  0.1202+0.0903j 0.1203+0.0903j
line_632_645 0.0000-0.0000j  0.2882+0.1936j 0.1152+0.0667j
line_645_646 0.0000+0.0000j  0.1153+0.0662j 0.1152+0.0663j
line_692_675 0.4886-0.0076j  0.0683-0.1395j 0.2907+0.0120j
line_671_684 0.1293+0.0866j -0.0000+0.0000j 0.1710-0.0192j
line_684_611 0.0000-0.0000j  0.0000+0.0000j 0.1705-0.0195j
line_684_652 0.1290+0.0864j  0.0000+0.0000j 0.0000+0.0000j
line_671_692 0.5736+0.0679j  0.0683-0.1395j 0.3757+0.0875j 

DSS results
                           A              B              C
line_sbs_650  1.2299+0.6523j 0.9181+0.4382j 1.2546+0.6278j
line_650_632  1.2288+0.6481j 0.9182+0.4366j 1.2525+0.6237j
line_632_670  1.0462+0.4528j 0.5113+0.1209j 0.9795+0.3876j
line_670_671  1.0255+0.4182j 0.4479+0.0813j 0.8553+0.3064j
line_671_680 -0.0000-0.0000j 0.0000-0.0000j 0.0000-0.0000j
line_632_633  0.1608+0.1112j 0.1203+0.0906j 0.1182+0.0887j
line_633_634  0.1604+0.1106j 0.1202+0.0903j 0.1179+0.0884j
line_632_645  0.0000+0.0000j 0.2883+0.1936j 0.1131+0.0655j
line_645_646  0.0000+0.0000j 0.1153+0.0662j 0.1131+0.0651j
line_692_675  0.4540+0.0104j 0.0683-0.1415j 0.2606+0.0275j
line_671_684  0.1197+0.0802j 0.0000+0.0000j 0.1523-0.0090j
line_684_611  0.0000+0.0000j 0.0000+0.0000j 0.1520-0.0093j
line_684_652  0.1195+0.0800j 0.0000+0.0000j 0.0000+0.0000j
line_671_692  0.5341+0.0816j 0.0683-0.1415j 0.3370+0.0953j


COMPARE Srx
Max |diff|:
A.(fbs - dss)   0.0722
B.(fbs - dss)   0.0029
C.(fbs - dss)   0.1301
dtype: float64
               A.(fbs - dss)   B.(fbs - dss)  C.(fbs - dss)
line_sbs_650  0.0678+0.0246j -0.0003-0.0029j 0.1237+0.0405j
line_650_632  0.0700+0.0148j -0.0004+0.0005j 0.1136+0.0219j
line_632_670  0.0706+0.0118j -0.0003+0.0011j 0.1062+0.0143j
line_670_671  0.0714+0.0056j -0.0000+0.0020j 0.0962+0.0042j
line_671_680 -0.0000-0.0000j  0.0000+0.0000j 0.0000+0.0000j
line_632_633 -0.0000-0.0000j -0.0000-0.0000j 0.0025+0.0019j
line_633_634  0.0000+0.0000j -0.0000-0.0000j 0.0025+0.0018j
line_632_645  0.0000+0.0000j -0.0000-0.0000j 0.0020+0.0012j
line_645_646  0.0000+0.0000j -0.0000-0.0000j 0.0020+0.0012j
line_692_675  0.0342-0.0184j -0.0000+0.0019j 0.0300-0.0156j
line_671_684  0.0095+0.0064j  0.0000+0.0000j 0.0185-0.0103j
line_684_611  0.0000+0.0000j  0.0000+0.0000j 0.0184-0.0104j
line_684_652  0.0094+0.0063j  0.0000+0.0000j 0.0000+0.0000j
line_671_692  0.0395-0.0136j -0.0000+0.0020j 0.0387-0.0078j 

FBS results
                          A              B              C
line_sbs_650 1.2966+0.6728j 0.9178+0.4337j 1.3762+0.6643j
line_650_632 1.2770+0.5788j 0.9195+0.4056j 1.3245+0.5637j
line_632_670 1.1130+0.4399j 0.5136+0.1204j 1.0736+0.3858j
line_670_671 1.0878+0.3746j 0.4533+0.0805j 0.9316+0.2884j
line_671_680 0.0000-0.0000j 0.0000+0.0000j 0.0000+0.0000j
line_632_633 0.1604+0.1106j 0.1202+0.0903j 0.1203+0.0903j
line_633_634 0.1600+0.1100j 0.1200+0.0900j 0.1200+0.0900j
line_632_645 0.0000+0.0000j 0.2853+0.1912j 0.1152+0.0663j
line_645_646 0.0000+0.0000j 0.1150+0.0660j 0.1150+0.0660j
line_692_675 0.4850-0.0100j 0.0680-0.1400j 0.2900+0.0120j
line_671_684 0.1290+0.0864j 0.0000+0.0000j 0.1705-0.0195j
line_684_611 0.0000+0.0000j 0.0000+0.0000j 0.1700-0.0200j
line_684_652 0.1280+0.0860j 0.0000+0.0000j 0.0000+0.0000j
line_671_692 0.5736+0.0679j 0.0683-0.1395j 0.3757+0.0875j 

DSS results
                          A               B               C
line_sbs_650 1.2288+0.6481j  0.9182+0.4366j  1.2525+0.6237j
line_650_632 1.2070+0.5640j  0.9199+0.4050j  1.2109+0.5418j
line_632_670 1.0424+0.4281j  0.5139+0.1193j  0.9674+0.3716j
line_670_671 1.0165+0.3690j  0.4533+0.0785j  0.8354+0.2841j
line_671_680 0.0000+0.0000j -0.0000-0.0000j -0.0000-0.0000j
line_632_633 0.1604+0.1106j  0.1202+0.0903j  0.1179+0.0884j
line_633_634 0.1600+0.1100j  0.1200+0.0900j  0.1175+0.0882j
line_632_645 0.0000+0.0000j  0.2853+0.1912j  0.1131+0.0651j
line_645_646 0.0000+0.0000j  0.1150+0.0660j  0.1130+0.0648j
line_692_675 0.4508+0.0084j  0.0680-0.1419j  0.2600+0.0276j
line_671_684 0.1195+0.0800j  0.0000+0.0000j  0.1520-0.0093j
line_684_611 0.0000+0.0000j  0.0000+0.0000j  0.1516-0.0096j
line_684_652 0.1186+0.0797j  0.0000+0.0000j  0.0000+0.0000j
line_671_692 0.5341+0.0816j  0.0683-0.1415j  0.3370+0.0953j
F

=================================== FAILURES ===================================
___________________________________ test_all ___________________________________

    def test_all():
        """
        Compare the python FBS solution to the opendss solution.
        To save output, run from command line:
        pytest ./fbs/tests/test_compare_opendss.py -s >[OUTPUT FILE PATH]
        Examples:
        $ pytest ./fbs/tests/test_compare_opendss.py -s > ./fbs/tests/06n3ph_unbal/06n3ph_out.txt
        $ pytest ./fbs/tests/test_compare_opendss.py -s > ./fbs/tests/05n3ph_unbal/05n3ph_out.txt
        """
        tolerance = .01
        for file in dss_files:
            print(f'\n\nTesting File: {file}')
>           compare_fbs_sol(file, tolerance)

fbs/tests/test_compare_opendss.py:32: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

dss_file = 'fbs/tests/IEEE_13_bus/IEEE_13_Bus_allwye_noxfm_noreg.dss'
tolerance = 0.01

    def compare_fbs_sol(dss_file, tolerance):
        #TODO: Figure out how to get Inode (iNR) and sV (sNR) at each node from dss and perform a compare
        # solve with fbs
        network = init_from_dss(dss_file)
        fbs_sol = get_fbs_solution(fbs(network))
    
        # solve with dss
        dss_sol = solve_with_dss(dss_file)
    
        fbsV, fbsI, fbsStx, fbsSrx = fbs_sol.V_df(), fbs_sol.I_df(), fbs_sol.Stx_df(), fbs_sol.Srx_df()
        dssV, dssI, dssStx, dssSrx = dss_sol
        print(f"FBS iterations: {fbs_sol.iterations}\t FBS convergence:{fbs_sol.diff}\t FBS tolerance: {fbs_sol.tolerance}")
        print("\n\nCOMPARE V")
        V_maxDiff = compare_dfs(fbsV, dssV)
        print("\n\nCOMPARE I")
        I_maxDiff = compare_dfs(fbsI, dssI)
        print("\n\nCOMPARE Stx")
        Stx_maxDiff = compare_dfs(fbsStx, dssStx)
        print("\n\nCOMPARE Srx")
        Srx_maxDiff = compare_dfs(fbsSrx, dssSrx)
    
>       assert (V_maxDiff <= tolerance).all()
E       assert False
E        +  where False = <bound method Series.all of A.(fbs - dss)     True\nB.(fbs - dss)     True\nC.(fbs - dss)    False\ndtype: bool>()
E        +    where <bound method Series.all of A.(fbs - dss)     True\nB.(fbs - dss)     True\nC.(fbs - dss)    False\ndtype: bool> = A.(fbs - dss)   0.0097\nB.(fbs - dss)   0.0069\nC.(fbs - dss)   0.0168\ndtype: float64 <= 0.01.all

fbs/tests/test_compare_opendss.py:56: AssertionError
=============================== warnings summary ===============================
tests/test_compare_opendss.py::test_all
  /Users/elainelaguerta/miniconda3/envs/pfp-env/lib/python3.8/site-packages/opendssdirect/utils.py:71: UserWarning: Empty list (opendssdirect.Transformers)
    warnings.warn("Empty list ({class_name})".format(class_name=class_name))

tests/test_compare_opendss.py::test_all
  /Users/elainelaguerta/Dropbox/LBNL/LinDist3Flow/fbs/fbs/solution.py:171: RuntimeWarning: invalid value encountered in true_divide
    new_line_I = np.conj(np.divide(node_s, node_V))

tests/test_compare_opendss.py::test_all
  /Users/elainelaguerta/Dropbox/LBNL/LinDist3Flow/fbs/fbs/solution.py:220: RuntimeWarning: invalid value encountered in true_divide
    node_I = np.conj(np.divide(node_sV,node_V))

-- Docs: https://docs.pytest.org/en/stable/warnings.html
=========================== short test summary info ============================
FAILED fbs/tests/test_compare_opendss.py::test_all - assert False
======================== 1 failed, 3 warnings in 1.68s =========================
